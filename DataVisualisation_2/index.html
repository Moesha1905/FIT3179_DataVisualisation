<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malaysia Tourism Dashboard (Static)</title>
  <link rel="stylesheet" href="styles.css">

  <!-- Vega Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <div class="dashboard">
    <header>
      <h1>From Peaks to Recovery: Malaysia's Tourism Evolution</h1>
      <span style="display: block; font-style: italic; margin-top: 5px; font-size: 1.1em; color: #aaa;">
        Overview of Malaysia's tourism trends
      </span>
    </header>

    <!-- === NUMBER CARDS SECTION === -->
    <section class="number-cards">
      <div class="number-card">
        <div class="region-name">Total Arrivals</div>
        <div id="arrivalsValue" class="number-value"></div>
      </div>

      <div class="number-card">
        <div class="region-name">Total Spendings</div>
        <div id="receiptsValue" class="number-value"></div>
      </div>

      <div class="number-card">
        <label for="yearSelect" style="display:block; margin-bottom:6px; font-size:0.9em;">
        </label>
        <select id="yearSelect" class="year-dropdown"></select>
      </div>
    </section>

    <!-- === FIRST ROW (ONE VISUALIZATION) === -->
    <section class="viz-row full-width">
      <div class="viz1">
        <h3>Proportional Symbol Map</h3>
        <p>Shows relative tourist volumes by state.</p>
        <div id="viz1" class="placeholder"></div>
      </div>
    </section>

    <!-- === SECOND ROW (ONE VISUALIZATION) === -->
    <section class="viz-row full-width">
      <div class="viz2">
        <h3>Choropleth Map</h3>
        <p>Shows intensity of arrivals by region.</p>
        <div id="viz2" class="placeholder"></div>
        <p style="font-style: italic; font-size: 0.9em; color: #777; margin-top: 6px;">
          Note: This visualisation focuses on the latest available year of data (2019).
        </p>
      </div>
    </section>

    <!-- === THIRD ROW (TWO VISUALIZATIONS) === -->
    <section class="viz-row two-col">
      <div class="viz3">
        <h3>Tourist Spending Trends</h3>
        <p>Tracks spending over time across regions.</p>
        <div id="viz3" class="placeholder"></div>
      </div>

      <div class="viz4">
        <h3>Tourism Expenditure by Category</h3>
        <p>Breakdown of expenses (e.g., lodging, transport).</p>
        <div id="viz4" class="placeholder"></div>
      </div>
    </section>

    <!-- === FOURTH ROW (TWO VISUALIZATIONS) === -->
    <section class="viz-row two-col">
      <div class="viz5">
        <h3>Tourism Growth Comparison</h3>
        <p>Compare key states' performance across years.</p>
        <div id="viz5" class="placeholder"></div>
      </div>

      <div class="viz6">
        <h3>Main Tourist Purpose</h3>
        <p>Highlights dominant motivations for travel.</p>
        <div id="viz6" class="placeholder"></div>
      </div>
    </section>
  </div>

  <footer>
    A visualisation by <strong>Moesha Novyna</strong> <br>
    Last Updated on <strong>16/10/2025</strong> <br>
    Data Sources: <strong>OpenDOSM, Kaggle, Tourism Malaysia Statistics</strong>.
  </footer>

  <!-- === TOURISM DATA SCRIPT (Number Cards) === -->
  <script>
    async function loadTourismData() {
      let data = [
        { Year: "2016", TotalReceipts: 19682000000, TotalArrivals: 26757000 },
        { Year: "2017", TotalReceipts: 20311000000, TotalArrivals: 25948000 },
        { Year: "2018", TotalReceipts: 21775000000, TotalArrivals: 25832000 },
        { Year: "2019", TotalReceipts: 22200000000, TotalArrivals: 26101000 }
      ];

      try {
        const response = await fetch("./tourism_data.csv");
        if (response.ok) {
          const csvText = await response.text();
          const rows = csvText.trim().split("\n").map(r => r.split(","));
          rows.shift();
          data = rows.map(r => ({
            Year: r[0],
            TotalReceipts: Number(r[1]),
            TotalArrivals: Number(r[2])
          }));
        } else {
          console.warn("CSV not found, using fallback data.");
        }
      } catch (err) {
        console.warn("Error loading CSV, using fallback data:", err);
      }

      const yearSelect = document.getElementById("yearSelect");
      const arrivalsValue = document.getElementById("arrivalsValue");
      const receiptsValue = document.getElementById("receiptsValue");

      data.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d.Year;
        opt.textContent = d.Year;
        yearSelect.appendChild(opt);
      });

      function formatNumber(num) {
        return num.toLocaleString("en-US");
      }

      function updateValues(year) {
        const selected = data.find(d => d.Year === year);
        if (selected) {
          arrivalsValue.textContent = formatNumber(selected.TotalArrivals);
          receiptsValue.textContent = "$ " + (selected.TotalReceipts / 1e9).toFixed(2) + " B";
        }
      }

      const latest = data[data.length - 1].Year;
      yearSelect.value = latest;
      updateValues(latest);

      // Event listener stays here - map update added later
      yearSelect.addEventListener("change", e => {
        const year = e.target.value;
        updateValues(year);
        // If proportional map view exists, update it
        if (window.vegaViews && window.vegaViews["viz1"]) {
          window.vegaViews["viz1"].signal("year_select", +year).runAsync();
        }
      });
    }

    loadTourismData();
  </script>

  <!-- === VEGA EMBEDDING SCRIPT === -->
  <script>
    const embedOptions = { actions: true };
    const visPaths = {
      viz1: "./proportional_map.json",
      viz2: "./choropleth_map.json",
      viz3: "./radar_chart.json",
      viz4: "./spending_category.json",
      viz5: "./growth_comparison.json",
      viz6: "./travel_purpose.json"
    };

    // Store Vega views for later updates
    window.vegaViews = {};

    async function embedVis(id, url) {
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`Failed to fetch ${url}`);
        const spec = await response.json();

        const result = await vegaEmbed(id, spec, embedOptions);
        window.vegaViews[id.replace("#", "")] = result.view;
      } catch (error) {
        console.error(`Error embedding ${url}:`, error);
      }
    }

    Object.entries(visPaths).forEach(([id, path]) => embedVis(`#${id}`, path));
  </script>
</body>
</html>
